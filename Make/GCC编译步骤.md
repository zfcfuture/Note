### GCC编译步骤

一个c/c++文件，需要经过**预处理**、**编译**、**汇编**和**连接**才能变成可执行文件。例如对于一个`hello.c`文件而言，它的具体编译过程如下：

#### 0.  源代码

```c
#include <sdtio.h>
int main() {
    printf("hello world\n");
    return 0;
}
```

#### 1.  预处理

执行 `gcc -o hello.i -E hello.c` 命令即可对源文件进行预处理，此时预处理器cpp会根据字符`#`开头的代码行，修改原始C程序。比如`hello.c`中第一行为`#include <stdio.h>`，==预处理器便将stdio.h的内容直接插入到程序中==，预处理之后得到文件`hello.i`，此时会发现由于插入了`stdio.h`，整个`hello.i`的行数由原来的5行变为了854行！

#### 2.  编译

执行 `gcc -o hello.s -S hello.i` 命令即可对预处理后的文件进行编译，此时汇编器ccl会将`hello.i`翻译为`hello.s`，这个文件中包含一个汇编程序

#### 3.  汇编

执行 `gcc -o hello.o -c hello.s` 命令即可对编译后的文件进行汇编，此时汇编器as会将`hello.s`翻译成机器语言保存在`hello.o`文件中，这是个二进制文件，可以用`hexdump hello.o`打开

#### 4.  链接

执行 `gcc -o hello hello.s` 命令即可对汇编后的文件进行链接，此时我们的hello程序调用了`printf`函数，这个函数是标准C库中的一个函数，它被保存在一个名为`printf.o`的文件中，这个文件必须要以某种方式合并到我们的`hello.o`程序中。而链接器ld就是负责处理这种合并，最后得到`hello`这个可执行文件，可以被加载到内存中由系统运行。如果想要查看详细的链接过程，可以加上`-v`参数。

`crt.o`、`crti.o`、`crtbegin.o`、`crtend.o`、`crtn.o`是gcc加入的系统标准启动文件，对于一般应用程序，这些启动是必须的

**`-lc`**：链接`libc`库文件，其中`libc`库文件中就实现了`printf`等函数

**`-lm`**：在使用`math.h`库时，gcc命令行必须加-lm选项，因为数学函数位于libm.so库文件中（这些库文件通常位于/lib目录下），-lm选项告诉编译器，我们程序中用到的数学函数要到这个库文件里找

**动态链接**（默认使用）：`gcc -o hello hello.o`

**静态链接**：编译链接时并不把库文件的代码加入到可执行文件中，而是在程序执行的时候动态加载链接库,这样可以节省系统开销`gcc -static -o hello hello.o`

**`-nostartfiles`**：不链接系统标准启动文件，而标准库文件仍然正常使用

**`-nostdlib`**（最常用）：不链接系统标准启动文件和标准库文件